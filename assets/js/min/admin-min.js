var ajaxurl=meta_image.ajaxurl,init={onReady:function(){init.imageUploader(),init.removeItem()},imageUploader:function(){var e;jQuery(".upload-image").click(function(t){t.preventDefault();var a=jQuery(this),r=jQuery(this).parent().attr("data-post"),n=jQuery(this).parent().attr("data-type");e=wp.media.frames.meta_image_frame=wp.media({title:meta_image.title,button:{text:meta_image.button},library:{type:"image, video"},multiple:!1}),e.on("select",function(){var t=e.state().get("selection").first().toJSON();"video"===t.type&&jQuery(".bannerWrap").append('<video muted autoplay id="bgvid" loop><source src="'+t.url+'" type="video/webm"><source src="'+t.url+'" type="video/ogv"><source src="'+t.url+'" type="video/mp4"></video><span class="button button-remove remove-banner">X</span>'),"image"===t.type&&jQuery(".bannerWrap").append('<img src="'+t.url+'" alt="" /><span class="button button-remove remove-banner">X</span>'),a.remove(),init.saveImage(r,n,t.url)}),e.open()})},saveImage:function(e,t,a){jQuery.ajax({url:ajaxurl,type:"GET",data:{postID:e,type:t,fieldVal:a,action:"setImage"},dataType:"html",success:function(){init.removeItem(),jQuery(".banner-image").remove()},error:function(e,t,a){window.alert(e+" :: "+t+" :: "+a)}})},removeItem:function(e,t,a){jQuery.ajax({url:ajaxurl,type:"GET",data:{action:"removeItem",postID:e,type:a,key:t},dataType:"html",error:function(e,t,a){window.alert(e+" :: "+t+" :: "+a)}}),jQuery(".button-remove").click(function(e){e.preventDefault();var t=jQuery(this).parent().attr("data-post"),a=jQuery(this).parent().attr("data-type"),r=jQuery(this).parent().attr("data-key");jQuery(this).hasClass("remove-banner")&&jQuery(this).parent().append('<a href="#" class="upload-image upload-banner">Set image/video</a>'),jQuery(this).prev().remove(),init.removeItem(t,r,a),init.imageUploader()})}};jQuery(document).ready(function(){init.onReady()});